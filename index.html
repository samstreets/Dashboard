<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard â€” Streets Services</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=JetBrains+Mono:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  /* ============================================
     Base & Reset (matches styles.css)
     ============================================ */
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#0e0e0e;--bg-card:#161616;--bg-hover:#1e1e1e;--border:#272727;
    --text:#f0ebe0;
    --text-muted:#9a9590;
    --text-dim:#555;
    --accent:#00e5cc;--accent-dim:rgba(0,229,204,0.12);--accent-glow:rgba(0,229,204,0.25);
    --up:#10b981;--down:#ef4444;--pending:#f59e0b;
    --font-display:'Playfair Display',Georgia,serif;
    --font-mono:'JetBrains Mono','Courier New',monospace;
    --focus-ring:0 0 0 3px rgba(0,229,204,0.55);
  }
  html{scroll-behavior:smooth}
  body{background:var(--bg);color:var(--text);font-family:var(--font-mono);font-size:14px;line-height:1.7;min-height:100vh;overflow-x:hidden}
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,204,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,204,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
  ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:#333;border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--accent)}
  a{color:var(--accent);text-decoration:none}

  /* ============================================
     Accessibility
     ============================================ */
  .skip-link{position:absolute;top:-100%;left:16px;background:var(--accent);color:#0e0e0e;padding:8px 16px;font-family:var(--font-mono);font-size:12px;font-weight:600;text-decoration:none;z-index:9999;border-radius:0 0 4px 4px;transition:top .15s}
  .skip-link:focus{top:0}
  :focus{outline:none}
  :focus-visible{outline:2px solid var(--accent);outline-offset:3px;box-shadow:var(--focus-ring);border-radius:2px}

  /* ============================================
     Navigation (matches styles.css nav-bar)
     ============================================ */
  .nav-bar{position:sticky;top:0;z-index:100;background:rgba(14,14,14,0.9);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:0 60px;display:flex;align-items:center;gap:0}
  .nav-prompt{font-family:var(--font-mono);font-size:11px;color:var(--accent);padding:14px 0;margin-right:16px;white-space:nowrap;user-select:none}
  .nav-links{display:flex;align-items:center;gap:0;list-style:none;flex:1}
  .nav-links a{display:block;padding:14px 20px;font-family:var(--font-mono);font-size:11px;letter-spacing:0.08em;color:var(--text-muted);text-decoration:none;transition:color .2s,background .2s;border-right:1px solid var(--border)}
  .nav-links li:first-child a{border-left:1px solid var(--border)}
  .nav-links a:hover,.nav-links a[aria-current="page"]{color:var(--accent);background:var(--accent-dim)}
  .nav-right{display:flex;align-items:center;gap:24px;margin-left:auto}
  .nav-clock{font-size:11px;color:var(--text-dim);letter-spacing:0.1em}
  .sys-badge{font-size:10px;letter-spacing:0.12em;text-transform:uppercase;color:var(--text-dim)}
  .sys-badge .ok{color:var(--up)}
  .sys-badge .warn{color:var(--pending)}
  .sys-badge .down{color:var(--down)}

  /* ============================================
     Page Header (matches styles.css page-header)
     ============================================ */
  .page-header{position:relative;z-index:1;padding:72px 60px 56px;max-width:1400px;margin:0 auto;border-bottom:1px solid var(--border)}
  .page-eyebrow{font-size:10px;letter-spacing:0.2em;text-transform:uppercase;color:var(--accent);margin-bottom:16px;display:flex;align-items:center;gap:10px}
  .page-eyebrow::before{content:'';display:inline-block;width:20px;height:1px;background:var(--accent)}
  .page-header h1{font-family:var(--font-display);font-size:clamp(36px,5vw,64px);font-weight:900;line-height:1.0;color:var(--text);letter-spacing:-1.5px;margin-bottom:14px}
  .page-header p{font-size:13px;color:var(--text-muted);max-width:520px;line-height:1.8}
  .header-dateline{font-size:11px;color:var(--text-dim);letter-spacing:0.08em;margin-top:10px}

  /* ============================================
     Content Layout
     ============================================ */
  .content{position:relative;z-index:1;max-width:1400px;margin:0 auto;padding:60px}
  .section-block{margin-bottom:60px}
  .block-header{display:flex;align-items:baseline;gap:16px;margin-bottom:32px}
  .block-num{font-size:10px;letter-spacing:0.2em;color:var(--accent);opacity:0.5;white-space:nowrap}
  .block-title{font-family:var(--font-display);font-size:clamp(20px,2.5vw,28px);font-weight:700;color:var(--text);letter-spacing:-0.5px}
  .block-line{flex:1;height:1px;background:var(--border);margin-left:16px}

  /* ============================================
     Uptime Summary Pills
     ============================================ */
  .summary-row{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap;align-items:center}
  .stat-pill{font-family:var(--font-mono);font-size:10px;letter-spacing:0.1em;text-transform:uppercase;display:inline-flex;align-items:center;gap:6px;padding:5px 12px;border:1px solid var(--border);background:var(--bg-card);color:var(--text-muted);transition:border-color .2s}
  .stat-pill.up{border-color:rgba(16,185,129,0.35);color:var(--up)}
  .stat-pill.down{border-color:rgba(239,68,68,0.35);color:var(--down)}
  .stat-pill.pending{border-color:rgba(245,158,11,0.35);color:var(--pending)}
  .refresh-btn{margin-left:auto;background:none;border:1px solid var(--border);color:var(--text-muted);font-family:var(--font-mono);font-size:10px;letter-spacing:0.1em;text-transform:uppercase;padding:5px 14px;cursor:pointer;transition:border-color .2s,color .2s,background .2s}
  .refresh-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-dim)}

  /* ============================================
     Monitor Grid (matches card-grid style)
     ============================================ */
  #monitors-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1px;background:var(--border);border:1px solid var(--border)}
  .monitor-item{background:var(--bg-card);padding:20px 24px;display:flex;flex-direction:column;gap:10px;transition:background .2s;position:relative;overflow:hidden}
  .monitor-item:hover{background:var(--bg-hover)}
  .monitor-item::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
  .monitor-item.is-up::before{background:var(--up)}
  .monitor-item.is-down::before{background:var(--down)}
  .monitor-item.is-pending::before{background:var(--pending)}
  .monitor-name{font-family:var(--font-display);font-size:15px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .monitor-meta{display:flex;align-items:center;justify-content:space-between}
  .monitor-label{font-family:var(--font-mono);font-size:9px;letter-spacing:0.2em;text-transform:uppercase;display:flex;align-items:center;gap:5px}
  .monitor-label::before{content:'';width:5px;height:5px;border-radius:50%;flex-shrink:0}
  .monitor-label.up{color:var(--up)}.monitor-label.up::before{background:var(--up);animation:pulse 2s infinite}
  .monitor-label.down{color:var(--down)}.monitor-label.down::before{background:var(--down)}
  .monitor-label.pending{color:var(--pending)}.monitor-label.pending::before{background:var(--pending)}
  .monitor-uptime{font-family:var(--font-mono);font-size:10px;color:var(--text-dim)}
  .uptime-bar{height:2px;background:var(--border);overflow:hidden}
  .uptime-fill{height:100%;transition:width 1.2s ease}
  .uptime-fill.up{background:var(--up)}
  .uptime-fill.down{background:var(--down)}
  .uptime-fill.pending{background:var(--pending)}

  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

  /* ============================================
     Loading / Error
     ============================================ */
  .loading-pulse{padding:28px;font-family:var(--font-mono);font-size:11px;letter-spacing:0.1em;color:var(--text-dim);background:var(--bg-card);display:flex;align-items:center;gap:10px}
  .loading-pulse::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--accent);animation:pulse 1s ease infinite;flex-shrink:0}
  .error-msg{padding:20px 24px;font-family:var(--font-mono);font-size:11px;color:var(--down);background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);letter-spacing:0.05em}

  /* ============================================
     App Shortcuts â€” section labels
     ============================================ */
  .apps-section{margin-bottom:40px}
  .apps-section:last-child{margin-bottom:0}
  .apps-section-label{font-family:var(--font-mono);font-size:9px;letter-spacing:0.25em;color:var(--text-dim);text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:12px}
  .apps-section-label::after{content:'';flex:1;height:1px;background:var(--border)}

  /* ============================================
     App Links (adapted from resource-card)
     ============================================ */
  .apps-grid-inner{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:1px;background:var(--border);border:1px solid var(--border)}
  .app-link{background:var(--bg-card);padding:20px 14px 16px;display:flex;flex-direction:column;align-items:center;gap:8px;text-decoration:none;color:var(--text-muted);font-family:var(--font-mono);font-size:10px;letter-spacing:0.05em;text-align:center;transition:background .2s,color .2s;position:relative;overflow:hidden}
  .app-link:hover{background:var(--bg-hover);color:var(--accent)}
  .app-link::after{content:'â†’';position:absolute;bottom:8px;right:10px;font-size:12px;color:var(--text-dim);transition:color .2s,transform .2s;opacity:0}
  .app-link:hover::after{color:var(--accent);transform:translateX(3px);opacity:1}
  .app-icon{font-size:1.4rem;line-height:1;margin-bottom:2px}
  .app-badge{font-family:var(--font-mono);font-size:8px;letter-spacing:0.12em;text-transform:uppercase;padding:2px 5px;position:absolute;top:6px;left:6px;line-height:1.4}
  .app-badge.local{background:rgba(0,229,204,0.1);color:var(--accent);border:1px solid rgba(0,229,204,0.2)}
  .app-badge.public{background:rgba(255,255,255,0.05);color:var(--text-dim);border:1px solid var(--border)}

  /* ============================================
     Footer
     ============================================ */
  .site-footer{position:relative;z-index:1;padding:32px 60px;display:flex;justify-content:space-between;align-items:center;max-width:1400px;margin:0 auto;flex-wrap:wrap;gap:16px;border-top:1px solid var(--border)}
  .site-footer p{font-size:11px;color:var(--text-dim);letter-spacing:0.08em}
  .site-footer a{color:var(--text-muted);text-decoration:none;transition:color .2s}
  .site-footer a:hover{color:var(--accent)}

  /* ============================================
     Animations
     ============================================ */
  @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  .page-header{animation:fadeUp .5s ease both}
  .section-block:nth-child(1){animation:fadeUp .5s .1s ease both;opacity:0;animation-fill-mode:forwards}
  .section-block:nth-child(2){animation:fadeUp .5s .2s ease both;opacity:0;animation-fill-mode:forwards}

  /* ============================================
     Reduced Motion
     ============================================ */
  @media(prefers-reduced-motion:reduce){
    *,*::before,*::after{animation-duration:.01ms !important;animation-iteration-count:1 !important;transition-duration:.01ms !important}
    html{scroll-behavior:auto}
    .monitor-label.up::before{animation:none}
  }

  /* ============================================
     Responsive
     ============================================ */
  @media(max-width:768px){
    .nav-bar,.page-header,.content,.site-footer{padding-left:24px;padding-right:24px}
    .page-header{padding-top:48px;padding-bottom:36px}
    .nav-right{display:none}
    #monitors-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
    .apps-grid-inner{grid-template-columns:repeat(auto-fill,minmax(100px,1fr))}
  }
  @media(max-width:480px){
    #monitors-grid{grid-template-columns:1fr 1fr}
    .apps-grid-inner{grid-template-columns:repeat(3,1fr)}
  }

  /* ============================================
     Visually hidden
     ============================================ */
  .visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>

<!-- ============================================================
  âš™ï¸  CONFIGURATION â€” edit this block to set up your instance
  ============================================================ -->
<script>
const CONFIG = {
  // â”€â”€ Branding â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  title: "Streets Services",

  // â”€â”€ Uptime Kuma â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  uptimeKumaUrl: "https://kuma.streetsservices.co.uk/api/status-page/default",
  corsProxy: "https://tight-wildflower-d4f9.samuel-streets.workers.dev/",

  // Auto-refresh interval in seconds (0 = disabled)
  refreshInterval: 60,

  // â”€â”€ App Shortcuts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  apps: [
    // â€” Internal / Homelab â€”
    { name: "Beszel",       url: "https://beszel.streetsservices.co.uk",            icon: "ğŸ“Š", type: "internal" },
    { name: "Bazarr",       url: "https://bazarr.streetsservices.co.uk/",           icon: "ğŸ’¬", type: "internal" },
    { name: "Crafty",       url: "https://crafty.streetsservices.co.uk",            icon: "â›ï¸", type: "internal" },
    { name: "Gotify",       url: "https://gotify.streetsservices.co.uk/#/login",    icon: "ğŸ””", type: "internal" },
    { name: "Immich",       url: "https://immich.streetsservices.co.uk/photos",     icon: "ğŸ–¼ï¸", type: "internal" },
    { name: "Lidarr",       url: "https://lidarr.streetsservices.co.uk/",           icon: "ğŸµ", type: "internal" },
    { name: "Overseerr",    url: "https://overseerr.streetsservices.co.uk/login",   icon: "ğŸ¬", type: "internal" },
    { name: "Prowlarr",     url: "https://prowlarr.streetsservices.co.uk/",         icon: "ğŸ”", type: "internal" },
    { name: "Proxmox",      url: "https://192.168.25.15:8006/",                     icon: "ğŸ–¥ï¸", type: "internal" },
    { name: "Portainer",    url: "https://portainer.streetsservices.co.uk/#!/auth", icon: "ğŸ³", type: "internal" },
    { name: "Plex",         url: "https://app.plex.tv/desktop",                     icon: "â–¶ï¸", type: "internal" },
    { name: "qBittorrent",  url: "https://qbittorrent.streetsservices.co.uk/",      icon: "â¬‡ï¸", type: "internal" },
    { name: "Radarr",       url: "https://radarr.streetsservices.co.uk/",           icon: "ğŸï¸", type: "internal" },
    { name: "Sonarr",       url: "https://sonarr.streetsservices.co.uk/",           icon: "ğŸ“¡", type: "internal" },
    { name: "Tautulli",     url: "https://tautulli.streetsservices.co.uk/home",     icon: "ğŸ“ˆ", type: "internal" },
    { name: "Tdarr",        url: "https://tdarr.streetsservices.co.uk/#/",          icon: "ğŸ—œï¸", type: "internal" },
    { name: "Uptime Kuma",  url: "https://kuma.streetsservices.co.uk/dashboard",    icon: "ğŸ’“", type: "internal" },
    { name: "Your Spotify", url: "https://spotify.streetsservices.co.uk/",          icon: "ğŸ§", type: "internal" },
    // â€” External / Public â€”
    { name: "GitHub",       url: "https://github.com/samstreets",           icon: "ğŸ™", type: "public" },
    { name: "Claude",       url: "https://claude.ai/",                      icon: "ğŸ¤–", type: "public" },
    { name: "Google",       url: "https://google.com",                      icon: "ğŸ”", type: "public" },
    { name: "Gmail",        url: "https://mail.google.com",                 icon: "ğŸ“§", type: "public" },
    { name: "Pass Portal",  url: "https://pass.proton.me/u/5/share/",       icon: "ğŸ”", type: "internal" },
  ]
};
</script>
<!-- ============================================================ -->

<a href="#main-content" class="skip-link">Skip to main content</a>

<!-- NAV -->
<nav class="nav-bar" aria-label="Main navigation">
  <span class="nav-prompt">~/dashboard $</span>
  <ul class="nav-links">
    <li><a href="#" aria-current="page">Dashboard</a></li>
    <li><a href="https://kuma.streetsservices.co.uk/dashboard" target="_blank" rel="noopener">Uptime</a></li>
    <li><a href="https://beszel.streetsservices.co.uk" target="_blank" rel="noopener">Beszel</a></li>
    <li><a href="https://portainer.streetsservices.co.uk/#!/auth" target="_blank" rel="noopener">Portainer</a></li>
  </ul>
  <div class="nav-right">
    <span class="sys-badge" id="sys-status">SYSTEM <span class="ok">NOMINAL</span></span>
    <span class="nav-clock" id="clock" aria-live="off">--:--:--</span>
  </div>
</nav>

<!-- PAGE HEADER -->
<div class="page-header" id="main-content">
  <div class="page-eyebrow">Homelab Control Panel</div>
  <h1>Streets Services<span style="color:var(--accent)">.</span></h1>
  <p>Service health, monitor status, and quick access to all internal and external tools.</p>
  <div class="header-dateline" id="dateline">â€” â€” â€”</div>
</div>

<!-- MAIN CONTENT -->
<main class="content">

  <!-- UPTIME KUMA -->
  <div class="section-block">
    <div class="block-header">
      <span class="block-num">01</span>
      <h2 class="block-title">Service Status</h2>
      <div class="block-line"></div>
    </div>

    <div class="summary-row" id="kuma-summary">
      <button class="refresh-btn" onclick="loadKuma()" aria-label="Refresh monitor status">â†» Sync</button>
    </div>

    <div id="monitors-grid">
      <div class="loading-pulse">Initialising monitors</div>
    </div>
  </div>

  <!-- APP SHORTCUTS -->
  <div class="section-block">
    <div class="block-header">
      <span class="block-num">02</span>
      <h2 class="block-title">Quick Access</h2>
      <div class="block-line"></div>
    </div>

    <div class="apps-section">
      <div class="apps-section-label">Internal â€” Homelab</div>
      <div class="apps-grid-inner" id="apps-internal"></div>
    </div>

    <div class="apps-section" style="margin-top:32px">
      <div class="apps-section-label">External â€” Public</div>
      <div class="apps-grid-inner" id="apps-public"></div>
    </div>
  </div>

</main>

<!-- FOOTER -->
<footer class="site-footer">
  <p>Streets Services &mdash; Internal Dashboard</p>
  <p><a href="https://github.com/samstreets" target="_blank" rel="noopener">github.com/samstreets</a></p>
</footer>

<script>
/* â”€â”€â”€ CLOCK â”€â”€â”€ */
function updateClock() {
  const n = new Date();
  document.getElementById('clock').textContent =
    n.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  document.getElementById('dateline').textContent =
    'â€” ' + n.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'}) + ' â€”';
}
setInterval(updateClock, 1000);
updateClock();

/* â”€â”€â”€ UPTIME KUMA â”€â”€â”€ */
async function loadKuma() {
  const grid = document.getElementById('monitors-grid');
  const summ = document.getElementById('kuma-summary');
  grid.innerHTML = '<div class="loading-pulse">Fetching monitors</div>';
  // Keep the refresh button in summary
  summ.innerHTML = '<button class="refresh-btn" onclick="loadKuma()" aria-label="Refresh monitor status">â†» Sync</button>';

  try {
    const listURL = CONFIG.uptimeKumaUrl;
    const hbURL   = listURL.replace("/status-page/", "/status-page/heartbeat/");

    const listRes = await fetch(CONFIG.corsProxy + listURL, { cache: 'no-store' });
    const hbRes   = await fetch(CONFIG.corsProxy + hbURL,  { cache: 'no-store' });

    if (!listRes.ok) throw new Error("LIST HTTP " + listRes.status);
    if (!hbRes.ok)   throw new Error("HEARTBEAT HTTP " + hbRes.status);

    const listData = await listRes.json();
    const hbData   = await hbRes.json();

    const monitors = [];
    const heartbeatList = hbData.heartbeatList || {};
    const uptimeList    = hbData.uptimeList || {};

    (listData.publicGroupList || []).forEach(group => {
      (group.monitorList || []).forEach(m => {
        const id    = m.id;
        const hbArr = heartbeatList[id];
        let hb = null;
        if (hbArr && hbArr.length) {
          hb = hbArr.reduce((latest, cur) =>
            new Date(cur.time) > new Date(latest.time) ? cur : latest
          );
        }
        const status = hb ? hb.status : 2;
        const upKey  = id + "_24";
        const uptime = uptimeList.hasOwnProperty(upKey)
          ? parseFloat((uptimeList[upKey] * 100).toFixed(2))
          : null;
        monitors.push({ name: m.name, status, uptime });
      });
    });

    renderMonitors(monitors, grid, summ);
    updateSysStatus(monitors);

  } catch (err) {
    grid.innerHTML = '<div class="error-msg">âš  Kuma error â€” ' + err.message + '</div>';
  }
}

function renderMonitors(monitors, grid, summ) {
  const up   = monitors.filter(m => m.status === 1).length;
  const down = monitors.filter(m => m.status === 0).length;
  const pend = monitors.filter(m => m.status === 2).length;

  summ.innerHTML =
    '<span class="stat-pill up">â–² ' + up + ' up</span>' +
    (down ? '<span class="stat-pill down">â–¼ ' + down + ' down</span>' : '') +
    (pend ? '<span class="stat-pill pending">â—† ' + pend + ' pending</span>' : '') +
    '<span class="stat-pill">' + monitors.length + ' total</span>' +
    '<button class="refresh-btn" onclick="loadKuma()" aria-label="Refresh monitor status">â†» Sync</button>';

  grid.innerHTML = monitors.map(m => {
    const cls   = m.status === 1 ? 'up' : m.status === 0 ? 'down' : 'pending';
    const label = m.status === 1 ? 'Operational' : m.status === 0 ? 'Down' : 'Pending';
    const upt   = m.uptime != null ? m.uptime : null;
    return '<div class="monitor-item is-' + cls + '">' +
      '<div class="monitor-name">' + m.name + '</div>' +
      '<div class="monitor-meta">' +
        '<span class="monitor-label ' + cls + '">' + label + '</span>' +
        (upt != null ? '<span class="monitor-uptime">' + upt + '%</span>' : '') +
      '</div>' +
      (upt != null ? '<div class="uptime-bar"><div class="uptime-fill ' + cls + '" style="width:' + upt + '%"></div></div>' : '') +
    '</div>';
  }).join('');
}

function updateSysStatus(monitors) {
  const down = monitors.filter(m => m.status === 0).length;
  const el   = document.getElementById('sys-status');
  el.innerHTML = down > 0
    ? 'SYSTEM <span class="down">' + down + ' service' + (down > 1 ? 's' : '') + ' down</span>'
    : 'SYSTEM <span class="ok">NOMINAL</span>';
}

/* â”€â”€â”€ APP SHORTCUTS â”€â”€â”€ */
function renderApps() {
  const internal = CONFIG.apps.filter(a => a.type === 'internal');
  const pub      = CONFIG.apps.filter(a => a.type === 'public');

  function buildGrid(apps, id) {
    document.getElementById(id).innerHTML = apps.map(a => {
      const isImg = a.icon && (a.icon.startsWith('http') || a.icon.startsWith('/'));
      const iconHtml = isImg
        ? '<div class="app-icon"><img src="' + a.icon + '" style="width:28px;height:28px;border-radius:4px;object-fit:cover"></div>'
        : '<div class="app-icon">' + a.icon + '</div>';
      const badgeClass = a.type === 'internal' ? 'local' : 'public';
      const badgeLabel = a.type === 'internal' ? 'local' : 'web';
      return '<a class="app-link" href="' + a.url + '" target="_blank" rel="noopener">' +
        '<span class="app-badge ' + badgeClass + '">' + badgeLabel + '</span>' +
        iconHtml +
        '<span>' + a.name + '</span>' +
      '</a>';
    }).join('');
  }

  buildGrid(internal, 'apps-internal');
  buildGrid(pub,      'apps-public');
}

/* â”€â”€â”€ BOOT â”€â”€â”€ */
function init() {
  renderApps();
  loadKuma();
  if (CONFIG.refreshInterval > 0)
    setInterval(() => { loadKuma(); }, CONFIG.refreshInterval * 1000);
}
init();
</script>

</body>
</html>
